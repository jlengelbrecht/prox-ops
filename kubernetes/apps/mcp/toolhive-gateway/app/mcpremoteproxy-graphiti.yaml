---
# MCPRemoteProxy for Graphiti MCP server
# Provides knowledge graph and RAG memory operations
# Named with -proxy suffix to avoid conflict with graphiti-mcp Deployment
apiVersion: toolhive.stacklok.dev/v1alpha1
kind: MCPRemoteProxy
metadata:
  name: graphiti-proxy
  namespace: mcp
  annotations:
    toolhive.stacklok.dev/registry-export: "true"
  labels:
    app.kubernetes.io/name: graphiti-proxy
    app.kubernetes.io/component: mcp-proxy
    app.kubernetes.io/part-of: toolhive-gateway
    toolhive.stacklok.dev/group: homelab-mcp
spec:
  remoteURL: http://graphiti-mcp.mcp.svc.cluster.local:8000
  # WORKAROUND: insecureAllowHTTP bypasses TLS verification for OIDC discovery
  # Required due to ToolHive bug #3142 - thvCABundlePath not applied to token validator
  # TODO: Remove insecureAllowHTTP once bug is fixed in upstream release
  # Tracking: STORY-030 in .claude/.ai-docs/stories/
  oidcConfig:
    type: inline
    inline:
      issuer: https://kubernetes.default.svc
      audience: toolhive
      jwksAllowPrivateIP: true
      insecureAllowHTTP: true
  audit:
    enabled: true
