---
# ExternalSecret for TrueNAS Heimdall MCP Server
# Pulls credentials from 1Password for TrueNAS SCALE access
# Required secrets in 1Password (item: truenas-heimdall-mcp in Homelab.0 vault):
#   - url: TrueNAS server URL (e.g., https://truenas-heimdall.homelab0.org)
#   - api_key: TrueNAS API key (generate in Settings â†’ API Keys)
#   - verify_ssl: SSL verification (false for self-signed certs)
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: truenas-heimdall-mcp-secrets
  namespace: mcp
  labels:
    app.kubernetes.io/name: truenas-heimdall-mcp
    app.kubernetes.io/component: mcp-server
    app.kubernetes.io/part-of: toolhive-gateway
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: truenas-heimdall-mcp-secrets
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        TRUENAS_URL: "{{ .url }}"
        TRUENAS_API_KEY: "{{ .apiKey }}"
        TRUENAS_VERIFY_SSL: "{{ .verifySsl }}"
  data:
    - secretKey: url
      remoteRef:
        key: truenas-heimdall-mcp
        property: url
    - secretKey: apiKey
      remoteRef:
        key: truenas-heimdall-mcp
        property: api_key
    - secretKey: verifySsl
      remoteRef:
        key: truenas-heimdall-mcp
        property: verify_ssl
