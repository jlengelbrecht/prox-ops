---
# ExternalSecret for CodeRabbit MCP Server
# Using stdio transport - requires GITHUB_PAT for GitHub API access
# Required secrets in 1Password (item: coderabbit-mcp-secrets):
#   - GITHUB_PAT: GitHub Personal Access Token with 'repo' or 'public_repo' scope
#     Used to fetch CodeRabbit reviews on pull requests
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: coderabbit-mcp-secrets
  namespace: mcp
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: coderabbit-mcp-secrets
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        github-pat: "{{ .githubPat }}"
  data:
    - secretKey: githubPat
      remoteRef:
        key: coderabbit-mcp-secrets
        property: GITHUB_PAT
