---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: cluster-secret-store
  namespace: flux-system
spec:
  interval: 10m
  path: ./kubernetes/apps/external-secrets/cluster-secret-store/app
  prune: true
  sourceRef:
    kind: GitRepository
    name: flux-system
  # Health checking disabled due to Flux bug #5311 - cluster-scoped custom
  # resources from external API groups fail with 'NotFound' even when healthy.
  # The ClusterSecretStore is stable and verified working via:
  #   kubectl get clustersecretstore onepassword-connect
  # Tracking: https://github.com/fluxcd/flux2/issues/5311
  timeout: 5m
  dependsOn:
    - name: 1password-connect
