---
# Container Escape Detection
# CRITICAL: Detects attempts to break out of containers
# Talos has shipped vulnerable runc (CVE-2024-21626) - this is a real threat
# LOGGING ONLY - No enforcement
apiVersion: cilium.io/v1alpha1
kind: TracingPolicy
metadata:
  name: container-escape-detection
spec:
  kprobes:
    - call: "fd_install"
      syscall: false
      args:
        - index: 0
          type: "int"
        - index: 1
          type: "file"
      selectors:
        - matchArgs:
            - index: 1
              operator: "Prefix"
              values:
                # Host init process - container escape indicator
                - "/proc/1/"
                # Container runtime sockets - full node compromise if accessed
                - "/run/containerd/"
                - "/var/run/containerd/"
          matchActions:
            - action: Post  # LOGGING ONLY - NO enforcement
