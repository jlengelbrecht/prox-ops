---
# PodDisruptionBudget for GitHub Actions Runners
# Ensures controlled eviction during node maintenance
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: github-runners-pdb
  namespace: github-actions
  labels:
    app.kubernetes.io/name: gha-runner-scale-set
    app.kubernetes.io/component: pdb
spec:
  # Limit voluntary disruptions to one runner at a time during node drains
  # No minAvailable set, allowing all runners to be evicted if necessary
  maxUnavailable: 1

  # Select runner pods
  selector:
    matchLabels:
      actions.github.com/scale-set-name: gha-runner-scale-set

  # Optional: Track disruptions
  unhealthyPodEvictionPolicy: IfHealthyBudget
