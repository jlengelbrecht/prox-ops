machine:
  kernel:
    modules:
      - name: nvidia
      - name: nvidia_uvm
      - name: nvidia_drm
      - name: nvidia_modeset
  sysctls:
    net.core.bpf_jit_harden: "1"  # NVIDIA GPU requirement
  files:
    - content: |
        [plugins]
          [plugins."io.containerd.cri.v1.runtime"]
            [plugins."io.containerd.cri.v1.runtime".containerd]
              [plugins."io.containerd.cri.v1.runtime".containerd.runtimes]
                [plugins."io.containerd.cri.v1.runtime".containerd.runtimes.nvidia]
                  privileged_without_host_devices = false
                  runtime_engine = ""
                  runtime_root = ""
                  runtime_type = "io.containerd.runc.v2"

                  [plugins."io.containerd.cri.v1.runtime".containerd.runtimes.nvidia.options]
                    BinaryName = "/usr/local/bin/nvidia-container-runtime"
      path: /etc/cri/conf.d/20-customization.part
      op: create
  nodeLabels:
    nvidia.com/gpu.present: "true"
    gpu.nvidia.com/model: "rtx-a2000"
    gpu.nvidia.com/class: "professional"
