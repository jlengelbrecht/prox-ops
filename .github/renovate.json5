{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "repositories": ["jlengelbrecht/prox-ops"],
  "extends": [
    "config:recommended",
    "docker:enableMajor",
    "helpers:pinGitHubActionDigests",
    "github>jlengelbrecht/prox-ops//.github/renovate/autoMerge.json5",
    "github>jlengelbrecht/prox-ops//.github/renovate/customManagers.json5",
    "github>jlengelbrecht/prox-ops//.github/renovate/groups.json5",
    "github>jlengelbrecht/prox-ops//.github/renovate/semanticCommits.json5",
  ],
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "Renovate Dashboard",
  "suppressNotifications": ["prEditedNotification", "prIgnoreNotification"],
  "rebaseWhen": "conflicted",
  "schedule": ["every weekend"],
  "pre-commit": {
    "enabled": true
  },
  "flux": {
    "fileMatch": ["kubernetes/.+\\.ya?ml$"]
  },
  "helm-values": {
    "fileMatch": ["kubernetes/.+\\.ya?ml$"]
  },
  "kubernetes": {
    "fileMatch": ["kubernetes/.+\\.ya?ml$"]
  },
  "regexManagers": [
    {
      "description": "Process custom dependencies in YAML files",
      "fileMatch": ["kubernetes/.+\\.ya?ml$"],
      "matchStrings": [
        // Match patterns like: tag: 1.2.3 with renovate comment
        "datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)( versioning=(?<versioning>\\S+))?\n.*?\"?(?<currentValue>[^\\s\"]+)\"?"
      ],
      "datasourceTemplate": "{{#if datasource}}{{{datasource}}}{{else}}github-releases{{/if}}",
      "versioningTemplate": "{{#if versioning}}{{{versioning}}}{{else}}semver{{/if}}"
    }
  ],
  "packageRules": [
    // === Disabled Updates ===
    {
      "description": "Disable kubernetes-api",
      "matchDatasources": ["kubernetes-api"],
      "enabled": false
    },
    {
      "description": "Disable Talos updates (managed via Terraform)",
      "matchDatasources": ["docker"],
      "matchPackagePatterns": ["ghcr.io/siderolabs/talos", "ghcr.io/siderolabs/installer"],
      "enabled": false
    },

    // === LinuxServer.io Images (version-v*.* and date-based formats) ===
    {
      "description": "Loose versioning for LinuxServer.io images",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": [
        "lscr.io/linuxserver/.*",
        "ghcr.io/linuxserver/.*"
      ]
    },

    // === onedr0p Images (4-segment versioning: major.minor.patch.build) ===
    // Covers: plex, sonarr, radarr-develop, prowlarr-develop, etc.
    // Note: qbittorrent and sabnzbd use standard semver but loose is harmless
    {
      "description": "Loose versioning for onedr0p images (4-segment versions)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": ["ghcr.io/onedr0p/.*"]
    },

    // === Calendar Versioning (YYYY.MM.PATCH format) ===
    {
      "description": "Loose versioning for Home Assistant (calendar versioning)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackageNames": ["ghcr.io/home-assistant/home-assistant"]
    },
    {
      "description": "Loose versioning for Cloudflared (calendar versioning)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackageNames": ["docker.io/cloudflare/cloudflared", "cloudflare/cloudflared"]
    },

    // === NVIDIA Images (complex version format: a.b.c-d.e.f-distro) ===
    {
      "description": "Loose versioning for NVIDIA container images",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": ["nvcr.io/nvidia/.*"]
    },

    // === Miscellaneous with non-standard versioning ===
    {
      "description": "Loose versioning for http-https-echo (single number tags)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackageNames": ["ghcr.io/mendhak/http-https-echo"]
    },

    // === Helm Charts ===
    {
      "description": "Group gabe565 chart and image updates",
      "matchDatasources": ["docker", "helm"],
      "matchPackagePatterns": ["ghcr.io/gabe565/.*"],
      "groupName": "gabe565"
    },

    // === Pin :latest tags (flag for manual pinning) ===
    {
      "description": "Flag images using :latest for pinning",
      "matchDatasources": ["docker"],
      "matchCurrentVersion": "latest",
      "enabled": false
    }
  ],
  "ignorePaths": [
    "**/*.sops.*",
    "**/resources/**"
  ]
}
