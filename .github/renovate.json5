{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "repositories": ["jlengelbrecht/prox-ops"],
  "extends": [
    "config:recommended",
    "docker:enableMajor",
    "helpers:pinGitHubActionDigests",
    "github>jlengelbrecht/prox-ops//.github/renovate/autoMerge.json5",
    "github>jlengelbrecht/prox-ops//.github/renovate/customManagers.json5",
    "github>jlengelbrecht/prox-ops//.github/renovate/groups.json5",
    "github>jlengelbrecht/prox-ops//.github/renovate/semanticCommits.json5",
  ],
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "Renovate Dashboard",
  "suppressNotifications": ["prEditedNotification", "prIgnoreNotification"],
  "rebaseWhen": "conflicted",
  "schedule": ["every weekend"],
  "pre-commit": {
    "enabled": true
  },
  "flux": {
    "fileMatch": ["kubernetes/.+\\.ya?ml$"]
  },
  "helm-values": {
    "fileMatch": ["kubernetes/.+\\.ya?ml$"]
  },
  "kubernetes": {
    "fileMatch": ["kubernetes/.+\\.ya?ml$"]
  },
  // Note: customManagers are defined in .github/renovate/customManagers.json5
  // The deprecated regexManagers property was removed - use customManagers instead
  "packageRules": [
    // === Disabled Updates ===
    {
      "description": "Disable kubernetes-api",
      "matchDatasources": ["kubernetes-api"],
      "enabled": false
    },
    {
      "description": "Disable Talos updates (managed via Terraform)",
      "matchDatasources": ["docker"],
      "matchPackagePatterns": ["ghcr.io/siderolabs/talos", "ghcr.io/siderolabs/installer"],
      "enabled": false
    },

    // === LinuxServer.io Images ===
    // BookStack uses version-v* format (e.g., version-v24.12.1) which requires regex versioning
    {
      "description": "Regex versioning for BookStack image (version-v prefix)",
      "matchDatasources": ["docker"],
      "versioning": "regex:^version-v(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)$",
      "matchPackageNames": ["ghcr.io/linuxserver/bookstack"]
    },
    // Other LinuxServer images may use different formats (date-based, etc.)
    {
      "description": "Loose versioning for other LinuxServer.io images",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": [
        "lscr.io/linuxserver/.*",
        "ghcr.io/linuxserver/.*"
      ],
      "excludePackageNames": ["ghcr.io/linuxserver/bookstack"]
    },

    // === onedr0p Images (4-segment versioning: major.minor.patch.build) ===
    // Covers: plex, sonarr, radarr-develop, prowlarr-develop, etc.
    // Note: qbittorrent and sabnzbd use standard semver but loose is harmless
    {
      "description": "Loose versioning for onedr0p images (4-segment versions)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": ["ghcr.io/onedr0p/.*"]
    },

    // === Calendar Versioning (YYYY.MM.PATCH format) ===
    {
      "description": "Loose versioning for Home Assistant (calendar versioning)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackageNames": ["ghcr.io/home-assistant/home-assistant"]
    },
    {
      "description": "Loose versioning for Cloudflared (calendar versioning)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackageNames": ["docker.io/cloudflare/cloudflared", "cloudflare/cloudflared"]
    },

    // === NVIDIA Images (complex version format: a.b.c-d.e.f-distro) ===
    {
      "description": "Loose versioning for NVIDIA container images",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": ["nvcr.io/nvidia/.*"]
    },

    // === Miscellaneous with non-standard versioning ===
    {
      "description": "Loose versioning for http-https-echo (single number tags)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackageNames": ["ghcr.io/mendhak/http-https-echo"]
    },

    // === Helm Charts ===
    // Note: This groups gabe565 CHART updates only (BookStack image is linuxserver, not gabe565)
    {
      "description": "Group gabe565 Helm chart updates",
      "matchDatasources": ["helm"],
      "matchPackagePatterns": ["ghcr.io/gabe565/.*"],
      "groupName": "gabe565-charts"
    },

    // === Pin :latest tags (flag for manual pinning) ===
    {
      "description": "Flag images using :latest for pinning",
      "matchDatasources": ["docker"],
      "matchCurrentVersion": "latest",
      "enabled": false
    }
  ],
  "ignorePaths": [
    "**/*.sops.*",
    "**/resources/**"
  ]
}
