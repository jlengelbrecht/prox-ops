{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "repositories": ["jlengelbrecht/prox-ops"],
  "extends": [
    "config:recommended",
    "docker:enableMajor",
    "helpers:pinGitHubActionDigests",
    "github>jlengelbrecht/prox-ops//.github/renovate/autoMerge.json5",
    "github>jlengelbrecht/prox-ops//.github/renovate/customManagers.json5",
    "github>jlengelbrecht/prox-ops//.github/renovate/groups.json5",
    "github>jlengelbrecht/prox-ops//.github/renovate/semanticCommits.json5",
  ],
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "ğŸ¤– Renovate Dashboard ğŸ¤–",
  "dependencyDashboardHeader": "## ğŸ  Homelab Dependency Management\n\nThis dashboard tracks all dependencies across the cluster. Updates are organized by category:\n\n| Emoji | Category | Description |\n|-------|----------|-------------|\n| ğŸ¬ | **Media** | Plex, *arr apps, request management |\n| ğŸ“š | **Homelab** | Documentation (BookStack) |\n| ğŸŒ | **Network** | Ingress, VPN, DNS, Cloudflare |\n| ğŸ”§ | **Core** | Flux, Cilium, CNI, system utilities |\n| ğŸ“Š | **Observability** | Prometheus, Grafana, Loki |\n| ğŸ’¾ | **Storage** | Rook-Ceph |\n| ğŸ” | **Security** | Authentik, External Secrets, cert-manager |\n| ğŸ–¥ï¸ | **CI/CD** | GitHub Actions, ARC runners |\n| ğŸ® | **GPU** | NVIDIA support |\n| ğŸ  | **IoT** | Home Assistant |\n| ğŸ› ï¸ | **Tools** | CLI tools (helm, flux, talos, sops, age) |\n| ğŸ—ï¸ | **Terraform** | Providers and IaC |\n| ğŸ“¦ | **Runtime** | Node.js, Python |\n\n**Schedule:** Updates run every weekend. Check a box to run immediately.\n\n---\n",
  "dependencyDashboardFooter": "\n---\n\nğŸ“š **Documentation:** [Renovate Docs](https://docs.renovatebot.com/) | âš™ï¸ **Config:** `.github/renovate.json5`",
  // Suppress noisy notifications
  "suppressNotifications": ["prEditedNotification", "prIgnoreNotification", "configErrorIssue"],
  "configWarningReuseIssue": false,
  "rebaseWhen": "conflicted",
  "schedule": ["every weekend"],
  // Use GitHub's native auto-merge for faster merges
  "platformAutomerge": true,
  "pre-commit": {
    "enabled": true
  },
  "flux": {
    "fileMatch": ["kubernetes/.+\\.ya?ml$"]
  },
  "helm-values": {
    "fileMatch": ["kubernetes/.+\\.ya?ml$"]
  },
  "kubernetes": {
    "fileMatch": ["kubernetes/.+\\.ya?ml$"]
  },
  // Base label for all Renovate PRs
  "labels": ["renovate"],

  // Note: customManagers are defined in .github/renovate/customManagers.json5
  // The deprecated regexManagers property was removed - use customManagers instead
  "packageRules": [
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PR Labels - Talos Upgrade Strategy (cattle vs pets)
    // These labels ONLY apply to Talos cluster version updates in:
    //   - terraform/variables.tf (Terraform-managed infrastructure)
    //   - talos/talenv.yaml (talhelper configuration)
    // They trigger the talos-version-router.yaml workflow which routes to:
    //   - cattle: destructive rebuild (major/minor versions)
    //   - pets: in-place talosctl upgrade (patch versions)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      "description": "Label Talos major/minor updates as cattle - Terraform",
      "matchDatasources": ["github-releases"],
      "matchPackageNames": ["siderolabs/talos"],
      "matchFileNames": ["terraform/variables.tf"],
      "matchUpdateTypes": ["major", "minor"],
      "addLabels": ["talos-update/cattle"]
    },
    {
      "description": "Label Talos patch updates as pets - Terraform",
      "matchDatasources": ["github-releases"],
      "matchPackageNames": ["siderolabs/talos"],
      "matchFileNames": ["terraform/variables.tf"],
      "matchUpdateTypes": ["patch"],
      "addLabels": ["talos-update/pets"]
    },
    {
      "description": "Label Talos major/minor updates as cattle - talenv",
      "matchDatasources": ["docker"],
      "matchPackageNames": ["ghcr.io/siderolabs/installer"],
      "matchFileNames": ["talos/talenv.yaml"],
      "matchUpdateTypes": ["major", "minor"],
      "addLabels": ["talos-update/cattle"]
    },
    {
      "description": "Label Talos patch updates as pets - talenv",
      "matchDatasources": ["docker"],
      "matchPackageNames": ["ghcr.io/siderolabs/installer"],
      "matchFileNames": ["talos/talenv.yaml"],
      "matchUpdateTypes": ["patch"],
      "addLabels": ["talos-update/pets"]
    },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PR Labels - Update Type
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      "description": "Label major version updates",
      "matchUpdateTypes": ["major"],
      "addLabels": ["update/major"]
    },
    {
      "description": "Label minor version updates",
      "matchUpdateTypes": ["minor"],
      "addLabels": ["update/minor"]
    },
    {
      "description": "Label patch version updates",
      "matchUpdateTypes": ["patch"],
      "addLabels": ["update/patch"]
    },
    {
      "description": "Label digest updates",
      "matchUpdateTypes": ["digest", "pinDigest"],
      "addLabels": ["update/digest"]
    },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PR Labels - Category (matching dashboard emoji groups)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      "description": "Label media app updates",
      "matchPackagePatterns": ["plex", "tautulli", "sonarr", "radarr", "prowlarr", "lidarr", "readarr", "overseerr", "wizarr", "maintainerr", "qbittorrent", "sabnzbd", "notifiarr", "huntarr", "cleanuparr"],
      "addLabels": ["deps/media"]
    },
    {
      "description": "Label homelab documentation updates",
      "matchPackagePatterns": ["bookstack"],
      "addLabels": ["deps/homelab"]
    },
    {
      "description": "Label network component updates",
      "matchPackagePatterns": ["envoy", "cloudflare", "gluetun", "wireguard", "external-dns", "k8s-gateway", "coredns"],
      "addLabels": ["deps/network"]
    },
    {
      "description": "Label core infrastructure updates",
      "matchPackagePatterns": ["flux", "cilium", "tetragon", "multus", "cni-plugins", "metrics-server", "reloader", "spegel", "app-template", "bjw-s"],
      "addLabels": ["deps/core"]
    },
    {
      "description": "Label observability updates",
      "matchPackagePatterns": ["prometheus", "grafana", "loki", "promtail", "alertmanager", "uptime-kuma", "gatus"],
      "addLabels": ["deps/observability"]
    },
    {
      "description": "Label storage updates",
      "matchPackagePatterns": ["rook", "ceph"],
      "addLabels": ["deps/storage"]
    },
    {
      "description": "Label security updates",
      "matchPackagePatterns": ["authentik", "external-secrets", "1password", "cert-manager", "jetstack"],
      "addLabels": ["deps/security"]
    },
    {
      "description": "Label CI/CD updates",
      "matchPackagePatterns": ["actions-runner", "gha-runner", "flux-local", "allenporter"],
      "addLabels": ["deps/cicd"]
    },
    {
      "description": "Label IoT updates",
      "matchPackagePatterns": ["home-assistant"],
      "addLabels": ["deps/iot"]
    },
    {
      "description": "Label GPU updates",
      "matchPackagePatterns": ["nvidia", "gpu-operator", "dcgm"],
      "addLabels": ["deps/gpu"]
    },
    {
      "description": "Label Terraform updates",
      "matchDatasources": ["terraform-provider"],
      "addLabels": ["deps/terraform"]
    },
    {
      "description": "Label CLI tools updates",
      "matchManagers": ["mise"],
      "addLabels": ["deps/tools"]
    },

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Stability Settings - Wait for releases to mature before updating critical infra
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      "description": "Wait 3 days for critical infrastructure updates",
      "matchPackagePatterns": ["cilium", "rook", "ceph", "flux", "envoy"],
      "minimumReleaseAge": "3 days",
      "prBodyNotes": ["âš ï¸ **Critical Infrastructure**: This update affects core cluster components. Review changelog carefully."]
    },
    {
      "description": "Wait 1 day for security component updates",
      "matchPackagePatterns": ["authentik", "external-secrets", "cert-manager"],
      "minimumReleaseAge": "1 day",
      "prBodyNotes": ["ğŸ” **Security Component**: Review for breaking changes in authentication/secrets handling."]
    },
    {
      "description": "Add context for media app updates",
      "matchPackagePatterns": ["plex", "sonarr", "radarr", "prowlarr", "tautulli"],
      "prBodyNotes": ["ğŸ¬ **Media App**: Check release notes for any migration steps or config changes."]
    },
    {
      "description": "Add context for Talos updates",
      "matchPackagePatterns": ["siderolabs/talos", "siderolabs/installer"],
      "prBodyNotes": ["âš ï¸ **Talos Linux**: Major/minor versions trigger cattle rebuild workflow. Patch versions use in-place upgrade."]
    },
    {
      "description": "Wait 2 days for observability stack updates",
      "matchPackagePatterns": ["prometheus", "grafana", "loki", "promtail", "alertmanager", "kube-prometheus-stack"],
      "minimumReleaseAge": "2 days",
      "prBodyNotes": ["ğŸ“Š **Observability**: Check for dashboard compatibility and alert rule changes."]
    },
    {
      "description": "Wait 2 days for NVIDIA/GPU updates",
      "matchPackagePatterns": ["nvidia", "dcgm", "gpu-operator"],
      "minimumReleaseAge": "2 days",
      "prBodyNotes": ["ğŸ® **GPU/NVIDIA**: Verify driver compatibility with Talos kernel modules."]
    },
    {
      "description": "Add context for VPN/network updates",
      "matchPackagePatterns": ["gluetun", "wireguard"],
      "prBodyNotes": ["ğŸŒ **VPN**: Test VPN connectivity and media app routing after update."]
    },
    {
      "description": "Add context for storage updates",
      "matchPackagePatterns": ["rook", "ceph"],
      "prBodyNotes": ["ğŸ’¾ **Storage**: Monitor OSD health and PG states after update. Consider maintenance window."]
    },
    {
      "description": "Add context for Home Assistant updates",
      "matchPackagePatterns": ["home-assistant"],
      "prBodyNotes": ["ğŸ  **Home Assistant**: Uses calendar versioning (YYYY.MM.x). Check breaking changes and integration updates."]
    },
    {
      "description": "Add context for CNI updates",
      "matchPackagePatterns": ["cilium", "multus", "cni-plugins", "tetragon"],
      "prBodyNotes": ["ğŸ”§ **CNI/Networking**: Critical cluster networking. Test pod-to-pod and multi-VLAN connectivity."]
    },

    // === Disabled Updates ===
    {
      "description": "Disable kubernetes-api",
      "matchDatasources": ["kubernetes-api"],
      "enabled": false
    },
    {
      "description": "Disable Talos updates (managed via Terraform)",
      "matchDatasources": ["docker"],
      "matchPackagePatterns": ["ghcr.io/siderolabs/talos", "ghcr.io/siderolabs/installer"],
      "enabled": false
    },

    // === LinuxServer.io Images ===
    // BookStack uses version-v* format (e.g., version-v24.12.1) which requires regex versioning
    {
      "description": "Regex versioning for BookStack image (version-v prefix)",
      "matchDatasources": ["docker"],
      "versioning": "regex:^version-v(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)$",
      "matchPackageNames": ["ghcr.io/linuxserver/bookstack"]
    },
    // Other LinuxServer images may use different formats (date-based, etc.)
    {
      "description": "Loose versioning for other LinuxServer.io images",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": [
        "lscr.io/linuxserver/.*",
        "ghcr.io/linuxserver/.*"
      ],
      "excludePackageNames": ["ghcr.io/linuxserver/bookstack"]
    },

    // === onedr0p Images (4-segment versioning: major.minor.patch.build) ===
    // Covers: plex, sonarr, radarr-develop, prowlarr-develop, etc.
    // Note: qbittorrent and sabnzbd use standard semver but loose is harmless
    {
      "description": "Loose versioning for onedr0p images (4-segment versions)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": ["ghcr.io/onedr0p/.*"]
    },

    // === Calendar Versioning (YYYY.MM.PATCH format) ===
    {
      "description": "Loose versioning for Home Assistant (calendar versioning)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackageNames": ["ghcr.io/home-assistant/home-assistant"]
    },
    {
      "description": "Loose versioning for Cloudflared (calendar versioning)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackageNames": ["docker.io/cloudflare/cloudflared", "cloudflare/cloudflared"]
    },

    // === NVIDIA Images (complex version format: a.b.c-d.e.f-distro) ===
    {
      "description": "Loose versioning for NVIDIA container images",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackagePatterns": ["nvcr.io/nvidia/.*"]
    },

    // === Miscellaneous with non-standard versioning ===
    {
      "description": "Loose versioning for http-https-echo (single number tags)",
      "matchDatasources": ["docker"],
      "versioning": "loose",
      "matchPackageNames": ["ghcr.io/mendhak/http-https-echo"]
    },

    // === Helm Charts ===
    // Note: This groups gabe565 CHART updates only (BookStack image is linuxserver, not gabe565)
    {
      "description": "Group gabe565 Helm chart updates",
      "matchDatasources": ["helm"],
      "matchPackagePatterns": ["ghcr.io/gabe565/.*"],
      "groupName": "gabe565-charts"
    },

    // === Pin :latest tags (flag for manual pinning) ===
    {
      "description": "Flag images using :latest for pinning",
      "matchDatasources": ["docker"],
      "matchCurrentVersion": "latest",
      "enabled": false
    }
  ],
  "ignorePaths": [
    "**/*.sops.*",
    "**/resources/**"
  ]
}
