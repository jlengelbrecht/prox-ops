{
  $schema: 'https://docs.renovatebot.com/renovate-schema.json',
  extends: [
    'config:recommended',
    'docker:enableMajor',
    'helpers:pinGitHubActionDigests',
    'github>jlengelbrecht/prox-ops//.github/renovate/autoMerge.json5',
    'github>jlengelbrecht/prox-ops//.github/renovate/customManagers.json5',
    'github>jlengelbrecht/prox-ops//.github/renovate/groups.json5',
    'github>jlengelbrecht/prox-ops//.github/renovate/semanticCommits.json5',
  ],
  dependencyDashboard: true,
  dependencyDashboardTitle: 'ü§ñ Renovate Dashboard ü§ñ',
  dependencyDashboardHeader: '## üè† Homelab Dependency Management\n\nThis dashboard tracks all dependencies across the cluster. Updates are organized by category:\n\n| Emoji | Category | Description |\n|-------|----------|-------------|\n| üé¨ | **Media** | Plex, *arr apps, request management |\n| üìö | **Homelab** | Documentation (BookStack) |\n| üåê | **Network** | Ingress, VPN, DNS, Cloudflare |\n| üîß | **Core** | Flux, Cilium, CNI, system utilities |\n| üìä | **Observability** | Prometheus, Grafana, Loki |\n| üíæ | **Storage** | Rook-Ceph |\n| üîê | **Security** | Authentik, External Secrets, cert-manager |\n| üñ•Ô∏è | **CI/CD** | GitHub Actions, ARC runners, flux-local |\n| üéÆ | **GPU** | NVIDIA support |\n| üè† | **IoT** | Home Assistant |\n| ü§ñ | **AI/ML** | Ollama, Open WebUI, LiteLLM, LightRAG |\n| üîå | **MCP** | Model Context Protocol servers |\n| üóÑÔ∏è | **Cache** | Valkey |\n| üêò | **Database** | CloudNative-PG, PostgreSQL |\n| üõ†Ô∏è | **Tools** | CLI tools (helm, flux, talos, sops, age) |\n| üèóÔ∏è | **Terraform** | Providers and IaC |\n| üì¶ | **Runtime** | Node.js, Python |\n\n**Schedule:** Updates run every weekend. Check a box to run immediately.\n\n---\n',
  dependencyDashboardFooter: '\n---\n\nüìö **Documentation:** [Renovate Docs](https://docs.renovatebot.com/) | ‚öôÔ∏è **Config:** `.github/renovate.json5`',
  suppressNotifications: [
    'prEditedNotification',
    'prIgnoreNotification',
    'configErrorIssue',
  ],
  configWarningReuseIssue: false,
  rebaseWhen: 'conflicted',
  schedule: [
    'every weekend',
  ],
  platformAutomerge: true,
  'pre-commit': {
    enabled: true,
  },
  flux: {
    managerFilePatterns: [
      '/kubernetes/.+\\.ya?ml$/',
    ],
  },
  'helm-values': {
    managerFilePatterns: [
      '/kubernetes/.+\\.ya?ml$/',
    ],
  },
  kubernetes: {
    managerFilePatterns: [
      '/kubernetes/.+\\.ya?ml$/',
    ],
  },
  labels: [
    'renovate',
  ],
  packageRules: [
    {
      description: 'Set explicit registryUrl for app-template to avoid duplicate HelmRepository warnings',
      matchDatasources: [
        'helm',
      ],
      matchPackageNames: [
        'app-template',
      ],
      registryUrls: [
        'https://bjw-s-labs.github.io/helm-charts',
      ],
    },
    {
      description: 'Label Talos major/minor updates as cattle - Terraform',
      matchDatasources: [
        'github-releases',
      ],
      matchPackageNames: [
        'siderolabs/talos',
      ],
      matchFileNames: [
        'terraform/variables.tf',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
      ],
      addLabels: [
        'talos-update/cattle',
      ],
    },
    {
      description: 'Label Talos patch updates as pets - Terraform',
      matchDatasources: [
        'github-releases',
      ],
      matchPackageNames: [
        'siderolabs/talos',
      ],
      matchFileNames: [
        'terraform/variables.tf',
      ],
      matchUpdateTypes: [
        'patch',
      ],
      addLabels: [
        'talos-update/pets',
      ],
    },
    {
      description: 'Label Talos major/minor updates as cattle - talenv',
      matchDatasources: [
        'docker',
      ],
      matchPackageNames: [
        'ghcr.io/siderolabs/installer',
      ],
      matchFileNames: [
        'talos/talenv.yaml',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
      ],
      addLabels: [
        'talos-update/cattle',
      ],
    },
    {
      description: 'Label Talos patch updates as pets - talenv',
      matchDatasources: [
        'docker',
      ],
      matchPackageNames: [
        'ghcr.io/siderolabs/installer',
      ],
      matchFileNames: [
        'talos/talenv.yaml',
      ],
      matchUpdateTypes: [
        'patch',
      ],
      addLabels: [
        'talos-update/pets',
      ],
    },
    {
      description: 'Label major version updates',
      matchUpdateTypes: [
        'major',
      ],
      addLabels: [
        'update/major',
      ],
    },
    {
      description: 'Label minor version updates',
      matchUpdateTypes: [
        'minor',
      ],
      addLabels: [
        'update/minor',
      ],
    },
    {
      description: 'Label patch version updates',
      matchUpdateTypes: [
        'patch',
      ],
      addLabels: [
        'update/patch',
      ],
    },
    {
      description: 'Label digest updates',
      matchUpdateTypes: [
        'digest',
        'pinDigest',
      ],
      addLabels: [
        'update/digest',
      ],
    },
    {
      description: 'Label media app updates',
      addLabels: [
        'deps/media',
      ],
      matchPackageNames: [
        '/plex/',
        '/tautulli/',
        '/sonarr/',
        '/radarr/',
        '/prowlarr/',
        '/lidarr/',
        '/readarr/',
        '/overseerr/',
        '/wizarr/',
        '/maintainerr/',
        '/qbittorrent/',
        '/sabnzbd/',
        '/notifiarr/',
        '/huntarr/',
        '/cleanuparr/',
      ],
    },
    {
      description: 'Label homelab documentation updates',
      addLabels: [
        'deps/homelab',
      ],
      matchPackageNames: [
        '/bookstack/',
      ],
    },
    {
      description: 'Label network component updates',
      addLabels: [
        'deps/network',
      ],
      matchPackageNames: [
        '/envoy/',
        '/cloudflare/',
        '/gluetun/',
        '/wireguard/',
        '/external-dns/',
        '/k8s-gateway/',
        '/coredns/',
      ],
    },
    {
      description: 'Label core infrastructure updates',
      addLabels: [
        'deps/core',
      ],
      matchPackageNames: [
        '/flux/',
        '/cilium/',
        '/tetragon/',
        '/multus/',
        '/cni-plugins/',
        '/metrics-server/',
        '/reloader/',
        '/spegel/',
        '/app-template/',
        '/bjw-s/',
      ],
    },
    {
      description: 'Label observability updates',
      addLabels: [
        'deps/observability',
      ],
      matchPackageNames: [
        '/prometheus/',
        '/grafana/',
        '/loki/',
        '/promtail/',
        '/alertmanager/',
        '/uptime-kuma/',
        '/gatus/',
      ],
    },
    {
      description: 'Label storage updates',
      addLabels: [
        'deps/storage',
      ],
      matchPackageNames: [
        '/rook/',
        '/ceph/',
      ],
    },
    {
      description: 'Label security updates',
      addLabels: [
        'deps/security',
      ],
      matchPackageNames: [
        '/authentik/',
        '/external-secrets/',
        '/1password/',
        '/cert-manager/',
        '/jetstack/',
        '/gitleaks/',
        '/ensure-sops/',
      ],
    },
    {
      description: 'Label CI/CD updates',
      addLabels: [
        'deps/cicd',
      ],
      matchPackageNames: [
        '/actions-runner/',
        '/gha-runner/',
        '/flux-local/',
        '/allenporter/',
      ],
    },
    {
      description: 'Label IoT updates',
      addLabels: [
        'deps/iot',
      ],
      matchPackageNames: [
        '/home-assistant/',
      ],
    },
    {
      description: 'Label GPU updates',
      addLabels: [
        'deps/gpu',
      ],
      matchPackageNames: [
        '/nvidia/',
        '/gpu-operator/',
        '/dcgm/',
      ],
    },
    {
      description: 'Label AI/ML updates',
      addLabels: [
        'deps/ai',
      ],
      matchPackageNames: [
        '/ollama/',
        '/open-webui/',
        '/litellm/',
        '/lightrag/',
        '/qdrant/',
      ],
    },
    {
      description: 'Label MCP server updates',
      addLabels: [
        'deps/mcp',
      ],
      matchPackageNames: [
        '/n8n-mcp/',
        '/czlonkowski/',
      ],
    },
    {
      description: 'Label cache service updates',
      addLabels: [
        'deps/cache',
      ],
      matchPackageNames: [
        '/valkey/',
      ],
    },
    {
      description: 'Label database service updates',
      addLabels: [
        'deps/database',
      ],
      matchPackageNames: [
        '/cloudnative-pg/',
        '/postgresql/',
        '/postgres/',
      ],
    },
    {
      description: 'Block PostgreSQL major version updates (require manual migration)',
      matchDatasources: [
        'docker',
      ],
      matchPackageNames: [
        '/ghcr.io/cloudnative-pg/postgresql/',
        '/postgres/',
      ],
      matchUpdateTypes: [
        'major',
      ],
      enabled: false,
    },
    {
      description: 'Label Terraform updates',
      matchDatasources: [
        'terraform-provider',
      ],
      addLabels: [
        'deps/terraform',
      ],
    },
    {
      description: 'Label CLI tools updates',
      matchManagers: [
        'mise',
      ],
      addLabels: [
        'deps/tools',
      ],
    },
    {
      description: 'Wait 3 days for critical infrastructure updates',
      minimumReleaseAge: '3 days',
      prBodyNotes: [
        '‚ö†Ô∏è **Critical Infrastructure**: This update affects core cluster components. Review changelog carefully.',
      ],
      matchPackageNames: [
        '/cilium/',
        '/rook/',
        '/ceph/',
        '/flux/',
        '/envoy/',
      ],
    },
    {
      description: 'Wait 1 day for security component updates',
      minimumReleaseAge: '1 day',
      prBodyNotes: [
        'üîê **Security Component**: Review for breaking changes in authentication/secrets handling.',
      ],
      matchPackageNames: [
        '/authentik/',
        '/external-secrets/',
        '/cert-manager/',
        '/gitleaks/',
        '/ensure-sops/',
      ],
    },
    {
      description: 'Add context for media app updates',
      prBodyNotes: [
        'üé¨ **Media App**: Check release notes for any migration steps or config changes.',
      ],
      matchPackageNames: [
        '/plex/',
        '/sonarr/',
        '/radarr/',
        '/prowlarr/',
        '/tautulli/',
      ],
    },
    {
      description: 'Add context for Talos updates',
      prBodyNotes: [
        '‚ö†Ô∏è **Talos Linux**: Major/minor versions trigger cattle rebuild workflow. Patch versions use in-place upgrade.',
      ],
      matchPackageNames: [
        '/siderolabs/talos/',
        '/siderolabs/installer/',
      ],
    },
    {
      description: 'Wait 2 days for observability stack updates',
      minimumReleaseAge: '2 days',
      prBodyNotes: [
        'üìä **Observability**: Check for dashboard compatibility and alert rule changes.',
      ],
      matchPackageNames: [
        '/prometheus/',
        '/grafana/',
        '/loki/',
        '/promtail/',
        '/alertmanager/',
        '/kube-prometheus-stack/',
      ],
    },
    {
      description: 'Wait 2 days for NVIDIA/GPU updates',
      minimumReleaseAge: '2 days',
      prBodyNotes: [
        'üéÆ **GPU/NVIDIA**: Verify driver compatibility with Talos kernel modules.',
      ],
      matchPackageNames: [
        '/nvidia/',
        '/dcgm/',
        '/gpu-operator/',
      ],
    },
    {
      description: 'Add context for VPN/network updates',
      prBodyNotes: [
        'üåê **VPN**: Test VPN connectivity and media app routing after update.',
      ],
      matchPackageNames: [
        '/gluetun/',
        '/wireguard/',
      ],
    },
    {
      description: 'Add context for storage updates',
      prBodyNotes: [
        'üíæ **Storage**: Monitor OSD health and PG states after update. Consider maintenance window.',
      ],
      matchPackageNames: [
        '/rook/',
        '/ceph/',
      ],
    },
    {
      description: 'Add context for Home Assistant updates',
      prBodyNotes: [
        'üè† **Home Assistant**: Uses calendar versioning (YYYY.MM.x). Check breaking changes and integration updates.',
      ],
      matchPackageNames: [
        '/home-assistant/',
      ],
    },
    {
      description: 'Add context for CNI updates',
      prBodyNotes: [
        'üîß **CNI/Networking**: Critical cluster networking. Test pod-to-pod and multi-VLAN connectivity.',
      ],
      matchPackageNames: [
        '/cilium/',
        '/multus/',
        '/cni-plugins/',
        '/tetragon/',
      ],
    },
    {
      description: 'Wait 2 days for AI/ML stack updates',
      minimumReleaseAge: '2 days',
      prBodyNotes: [
        'ü§ñ **AI/ML**: Rapidly evolving stack. Check for breaking API changes, model compatibility, and integration updates.',
      ],
      matchPackageNames: [
        '/ollama/',
        '/open-webui/',
        '/litellm/',
        '/lightrag/',
        '/qdrant/',
      ],
    },
    {
      description: 'Wait 1 day for MCP server updates',
      minimumReleaseAge: '1 day',
      prBodyNotes: [
        'üîå **MCP Server**: Check for breaking protocol changes and verify LiteLLM gateway compatibility.',
      ],
      matchPackageNames: [
        '/n8n-mcp/',
        '/czlonkowski/',
      ],
    },
    {
      description: 'Wait 3 days for database updates',
      minimumReleaseAge: '3 days',
      prBodyNotes: [
        'üêò **Database**: Critical data infrastructure. PostgreSQL major versions are blocked (require pg_upgrade).',
      ],
      matchPackageNames: [
        '/cloudnative-pg/',
        '/postgresql/',
        '/postgres/',
      ],
    },
    {
      description: 'Wait 3 days for flux-local CI validation tool updates',
      minimumReleaseAge: '3 days',
      prBodyNotes: [
        'üñ•Ô∏è **CI Validation**: flux-local is a required validation step for all PRs. Test locally with `flux-local test` before merging. Known issue: [#986](https://github.com/allenporter/flux-local/issues/986) affects CloudNative-PG charts.',
      ],
      matchPackageNames: [
        'ghcr.io/allenporter/flux-local',
      ],
    },
    {
      description: 'Disable kubernetes-api',
      matchDatasources: [
        'kubernetes-api',
      ],
      enabled: false,
    },
    {
      description: 'Disable Talos updates (managed via Terraform)',
      matchDatasources: [
        'docker',
      ],
      enabled: false,
      matchPackageNames: [
        '/ghcr.io/siderolabs/talos/',
        '/ghcr.io/siderolabs/installer/',
      ],
    },
    {
      description: 'Regex versioning for BookStack image (version-v prefix)',
      matchDatasources: [
        'docker',
      ],
      versioning: 'regex:^version-v(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)$',
      matchPackageNames: [
        'ghcr.io/linuxserver/bookstack',
      ],
    },
    {
      description: 'LinuxServer.io stable builds only (requires -ls suffix)',
      matchDatasources: [
        'docker',
      ],
      // STABLE ONLY: Requires -ls{build} suffix to ensure production-ready releases
      // Matches: 2.3.0.5236-ls134, 1.42.2.10156-f737b826c-ls287 (Plex), 4.0.16.2944-ls299
      // Matches: 5.1.4-r1-ls431 (qBittorrent uses -r{N} revision format)
      // Excludes: nightly-*, develop-*, unstable-* prefixed tags (non-production)
      // Excludes: 19e00ee2-ls3 (commit hash without version), 2.3.1-nightly (invalid format)
      // Reference: https://www.linuxserver.io/blog/docker-tags-so-many-tags-so-little-time
      versioning: 'regex:^(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)(?:\\.(?<build>\\d+))?(?:-(?:r\\d+|[a-f0-9]+))?-ls(?<revision>\\d+)$',
      matchPackageNames: [
        '/lscr.io/linuxserver/.*/',
        '/ghcr.io/linuxserver/.*/',
        '!ghcr.io/linuxserver/bookstack',
      ],
    },
    {
      description: 'Loose versioning for onedr0p images (4-segment versions)',
      matchDatasources: [
        'docker',
      ],
      versioning: 'loose',
      matchPackageNames: [
        '/ghcr.io/onedr0p/.*/',
      ],
    },
    {
      description: 'Home Assistant stable releases only (excludes dev/beta)',
      matchDatasources: [
        'docker',
      ],
      // Calendar versioning YYYY.MM.patch - stable releases only
      // Matches: 2024.12.5, 2025.1.0, 2025.12.4
      // Excludes: 2025.12.0b0 (beta), 2026.1.0.dev202512210247 (dev)
      versioning: 'regex:^(?<major>\\d{4})\\.(?<minor>\\d{1,2})\\.(?<patch>\\d+)$',
      matchPackageNames: [
        'ghcr.io/home-assistant/home-assistant',
      ],
    },
    {
      description: 'Loose versioning for Cloudflared (calendar versioning)',
      matchDatasources: [
        'docker',
      ],
      versioning: 'loose',
      matchPackageNames: [
        'docker.io/cloudflare/cloudflared',
        'cloudflare/cloudflared',
      ],
    },
    {
      description: 'Loose versioning for NVIDIA container images',
      matchDatasources: [
        'docker',
      ],
      versioning: 'loose',
      matchPackageNames: [
        '/nvcr.io/nvidia/.*/',
      ],
    },
    {
      description: 'Loose versioning for http-https-echo (single number tags)',
      matchDatasources: [
        'docker',
      ],
      versioning: 'loose',
      matchPackageNames: [
        'ghcr.io/mendhak/http-https-echo',
      ],
    },
    {
      description: 'Group gabe565 Helm chart updates',
      matchDatasources: [
        'helm',
      ],
      groupName: 'gabe565-charts',
      matchPackageNames: [
        '/ghcr.io/gabe565/.*/',
      ],
    },
    {
      description: 'Uptime Kuma stable releases only (excludes beta/nightly/variants)',
      matchDatasources: [
        'docker',
      ],
      // Matches: 1.23.17, 2.0.2, 2.0.0
      // Excludes: 2.1.0-beta.0, nightly1, 1.23.17-alpine, 2.0.2-slim, 2.0.2-rootless
      versioning: 'regex:^(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)$',
      matchPackageNames: [
        'louislam/uptime-kuma',
      ],
    },
    {
      description: 'MariaDB stable releases only (excludes RC/variants)',
      matchDatasources: [
        'docker',
      ],
      // Matches: 12.1.2, 11.8.5, 11.4.9
      // Excludes: 12.2.1-rc, 12.1.2-noble, 12.1.2-ubi10, lts-ubi9
      versioning: 'regex:^(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)$',
      minimumReleaseAge: '3 days',
      prBodyNotes: [
        'üêò **MariaDB**: Major versions may have breaking SQL syntax or config changes. Review release notes carefully before merging.',
      ],
      matchPackageNames: [
        'docker.io/mariadb',
        'mariadb',
      ],
    },
    {
      description: 'Homepage stable releases only (semver with v prefix)',
      matchDatasources: [
        'docker',
      ],
      // Matches: v1.8.0, v0.10.9
      // Excludes: latest, dev
      versioning: 'regex:^v(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)$',
      matchPackageNames: [
        'ghcr.io/gethomepage/homepage',
      ],
    },
    {
      description: 'Flag images using :latest for pinning',
      matchDatasources: [
        'docker',
      ],
      matchCurrentVersion: 'latest',
      enabled: false,
    },
  ],
  ignorePaths: [
    '**/*.sops.*',
    '**/resources/**',
  ],
}
